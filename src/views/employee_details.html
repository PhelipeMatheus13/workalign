<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../public/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <title>WorkAlign - Employee Details</title>
    <style>
        /* --- Ajustes gerais --- */
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background: #f6f9fb;
        }

        .container-fluid {
            padding: 0;
            height: 100vh;
        }

        .row {
            margin: 0;
            height: 100%;
        }

        /* Coluna principal */
        .col-md-9 {
            height: 100%;
            padding: 0;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* Container principal */
        .content-container {
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header da página */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .page-title {
            color: #2c3e50;
            font-weight: 600;
            font-size: 1.8rem;
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        /* Card de detalhes do funcionário */
        .employee-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        /* Grid de informações compacto */
        .info-grid-compact {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .info-section {
            margin-bottom: 25px;
        }

        .section-title {
            color: #2c3e50;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e9ecef;
        }

        .info-item {
            margin-bottom: 12px;
        }

        .info-label {
            color: #6c757d;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            color: #2c3e50;
            font-size: 1rem;
            font-weight: 500;
        }

        .info-value.empty {
            color: #bdc3c7;
            font-style: italic;
        }

        /* Estados de loading e erro */
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .error-message {
            text-align: center;
            padding: 20px;
            color: #dc3545;
            background-color: #f8d7da;
            border-radius: 5px;
            margin: 10px 0;
        }

        /* Botões */
        .btn-back {
            background-color: #6c757d;
            border-color: #6c757d;
            color: white;
        }

        .btn-edit {
            background-color: #007bff;
            border-color: #007bff;
            color: white;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            border-radius: 4px;
        }

        /* Ajustes para mobile */
        @media (max-width: 768px) {
            .col-md-9 {
                height: calc(100vh - 56px);
            }

            .content-container {
                padding: 15px;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                margin-bottom: 20px;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .info-grid-compact {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .employee-card {
                padding: 20px;
            }
        }

        /* -----------------------
           LAYOUT: fixar menu lateral
           ----------------------- */
        @media (min-width: 768px) {
            .col-md-3.menu {
                position: fixed;
                top: 56px;
                left: 0;
                height: calc(100vh - 56px);
                overflow-y: auto;
                width: 25%;
                z-index: 1020;
            }

            .main-content {
                margin-left: 25%;
                max-height: calc(100vh - 56px);
                overflow-y: auto;
            }

            .container-fluid,
            .row {
                width: 100%;
                margin: 0;
                padding: 0;
            }
        }

        @media (max-width: 767.98px) {
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="../../public/index.html">
            <i class="fa-solid fa-users-gear" style="color: #ffffff;"></i> WorkAlign
        </a>

        <!-- Botão do menu mobile -->
        <button class="navbar-toggler d-md-none" type="button" data-toggle="collapse" data-target="#navbarMobileMenu">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Menu mobile (dropdown) -->
        <div class="collapse navbar-collapse d-md-none" id="navbarMobileMenu">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="../../public/index.html" data-menu="dashboard">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="employees.html" data-menu="employees">
                        <i class="fas fa-users"></i> Employees
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="departments.html" data-menu="departments">
                        <i class="fas fa-briefcase"></i> Departments
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-menu="reports">
                        <i class="fas fa-chart-bar"></i> Reports
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- MENU LATERAL -->
            <div class="col-md-3 menu d-none d-md-block">
                <ul class="menu">
                    <li>
                        <a href="../../public/index.html" class="menu-item" data-menu="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="employees.html" class="menu-item" data-menu="employees">
                            <i class="fas fa-users"></i>
                            <span>Employees</span>
                        </a>
                    </li>
                    <li>
                        <a href="departments.html" class="menu-item" data-menu="departments">
                            <i class="fas fa-briefcase"></i>
                            <span>Departments</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="menu-item" data-menu="reports">
                            <i class="fas fa-chart-bar"></i>
                            <span>Reports</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- CONTEÚDO PRINCIPAL -->
            <div class="col-md-9 main-content">
                <div class="content-container">
                    <!-- Header da página -->
                    <div class="page-header">
                        <h1 class="page-title">Employee Details</h1>
                        <div class="header-actions">
                            <a href="employees.html">
                                <button type="button" class="btn btn-back btn-sm">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                            </a>
                            <button type="button" class="btn btn-edit btn-sm" id="editEmployeeBtn">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </div>
                    </div>

                    <!-- Card de detalhes do funcionário -->
                    <div class="employee-card" id="employeeCard">
                        <div class="loading" id="loadingState">
                            <div class="loading-spinner"></div>
                            <p>Loading employee data...</p>
                        </div>

                        <div id="employeeContent" style="display: none;">
                            <!-- Informações pessoais -->
                            <div class="info-section">
                                <h3 class="section-title">Personal Information</h3>
                                <div class="info-grid-compact">
                                    <div class="info-item">
                                        <div class="info-label">First Name</div>
                                        <div class="info-value" id="firstName">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Last Name</div>
                                        <div class="info-value" id="lastName">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Date of Birth</div>
                                        <div class="info-value" id="dateOfBirth">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Email Address</div>
                                        <div class="info-value" id="email">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Primary Phone</div>
                                        <div class="info-value" id="primaryPhone">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Secondary Phone</div>
                                        <div class="info-value empty" id="secondaryPhone">Not provided</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Informações profissionais -->
                            <div class="info-section">
                                <h3 class="section-title">Professional Information</h3>
                                <div class="info-grid-compact">
                                    <div class="info-item">
                                        <div class="info-label">Department</div>
                                        <div class="info-value" id="department">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Role</div>
                                        <div class="info-value" id="role">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Salary</div>
                                        <div class="info-value" id="salary">-</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Hire Date</div>
                                        <div class="info-value" id="hireDate">-</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Endereço (linha completa) -->
                            <div class="info-section">
                                <h3 class="section-title">Address</h3>
                                <div class="info-item">
                                    <div class="info-value" id="address">-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="../../public/js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Marcar o menu de employees como ativo
            const menuItems = document.querySelectorAll('.menu-item, #navbarMobileMenu .nav-link');
            menuItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-menu') === 'employees') {
                    item.classList.add('active');
                }
            });

            // Salvar no localStorage que estamos na página de employees
            localStorage.setItem('activeMenu', 'employees');

            // Obter ID do funcionário da URL
            const urlParams = new URLSearchParams(window.location.search);
            const employeeId = urlParams.get('id');

            if (employeeId) {
                loadEmployeeData(employeeId);
            } else {
                showError('Employee ID is missing in the URL.');
            }

            // Botão de editar - redireciona para a página de edição
            document.getElementById('editEmployeeBtn').addEventListener('click', function () {
                if (employeeId) {
                    window.location.href = `edit_employee.html?id=${employeeId}`;
                } else {
                    alert('Cannot edit: Employee ID not found');
                }
            });

            // Função para carregar dados do funcionário
            function loadEmployeeData(employeeId) {
                fetch(`../controllers/get_employee_by_id.php?id=${employeeId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            populateEmployeeData(data.employee);
                        } else {
                            throw new Error(data.error || 'Failed to load employee data');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showError('Error loading employee data: ' + error.message);
                    });
            }

            // Função para preencher os dados do funcionário
            function populateEmployeeData(employee) {
                // Esconder loading e mostrar conteúdo
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('employeeContent').style.display = 'block';

                // Preencher dados pessoais
                document.getElementById('firstName').textContent = employee.first_name || '-';
                document.getElementById('lastName').textContent = employee.last_name || '-';
                document.getElementById('dateOfBirth').textContent = formatDate(employee.date_of_birth) || '-';
                document.getElementById('email').textContent = employee.email || '-';
                document.getElementById('primaryPhone').textContent = formatPhone(employee.primary_phone) || '-';

                const secondaryPhone = document.getElementById('secondaryPhone');
                if (employee.secondary_phone) {
                    secondaryPhone.textContent = formatPhone(employee.secondary_phone);
                    secondaryPhone.classList.remove('empty');
                } else {
                    secondaryPhone.textContent = 'Not provided';
                    secondaryPhone.classList.add('empty');
                }

                // Preencher dados profissionais
                document.getElementById('department').textContent = employee.department_name || '-';
                document.getElementById('role').textContent = employee.role_name || '-';
                document.getElementById('salary').textContent = employee.salary ? `$${parseFloat(employee.salary).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` : '-';
                document.getElementById('hireDate').textContent = formatDate(employee.hire_date) || '-';
                document.getElementById('address').textContent = employee.address || '-';
            }

            // Função para mostrar erro
            function showError(message) {
                document.getElementById('loadingState').style.display = 'none';
                const employeeCard = document.getElementById('employeeCard');
                employeeCard.innerHTML = `<div class="error-message">${message}</div>`;
            }

            // Função para formatar data (de YYYY-MM-DD para DD/MM/YYYY)
            function formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return dateString; // Retorna original se não for data válida

                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            }

            // Função para formatar telefone
            function formatPhone(phone) {
                if (!phone) return '';
                // Remove caracteres não numéricos
                const cleaned = phone.replace(/\D/g, '');

                // Formata para (XXX) XXX-XXXX
                if (cleaned.length === 10) {
                    return `(${cleaned.substring(0, 3)}) ${cleaned.substring(3, 6)}-${cleaned.substring(6)}`;
                }

                // Se não for 10 dígitos, retorna o original
                return phone;
            }
        });
    </script>
</body>

</html>